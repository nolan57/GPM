# 插件式甘特图管理软件(GPM)插件系统设计文档

## 1. 系统概述

本设计文档描述了甘特图管理软件(GPM)中的插件系统架构，该系统允许用户通过插件扩展软件的图形标识功能。插件系统采用接口设计，支持多种类型的图形标识（文本、形状、线条等），并允许用户自定义配置这些标识的属性。

## 2. 插件系统架构

### 2.1 核心接口

插件系统的核心是`IAnnotationPlugin`接口，它定义了所有图形标识插件必须实现的方法和属性：

```csharp
public interface IAnnotationPlugin
{
    string Name { get; }             // 插件名称
    string Description { get; }      // 插件描述
    AnnotationType Type { get; }     // 插件类型
    UserControl GetAnnotationControl();  // 获取插件配置控件
    UIElement CreateAnnotationElement(IAnnotationConfig config);  // 创建标识元素
    void ConfigureAnnotation(UIElement element, IAnnotationConfig config);  // 配置标识元素
}
```

### 2.2 插件类型

系统支持以下几种类型的图形标识插件：

```csharp
public enum AnnotationType
{
    Text,       // 文本标识
    Shape,      // 形状标识
    Image,      // 图像标识
    Line,       // 线条标识
    Connector,  // 连接线标识
    Highlight   // 高亮标识
}
```

### 2.3 配置接口

每个插件都需要一个配置对象来定义标识的属性：

```csharp
public interface IAnnotationConfig
{
    string Text { get; set; }    // 文本内容
    Color Color { get; set; }    // 颜色
    double Opacity { get; set; } // 透明度
    double Size { get; set; }    // 大小
}
```

## 3. 插件实现

### 3.1 文本注释插件

`TextAnnotationPlugin`允许用户在甘特图上添加文本注释。它包含以下特性：

- 可自定义文本内容
- 可设置字体大小、颜色、样式（粗体、斜体）
- 可调整透明度

```csharp
public class TextAnnotationPlugin : IAnnotationPlugin
{
    public string Name => "Text Annotation";
    public string Description => "Create text annotations on the Gantt chart";
    public AnnotationType Type => AnnotationType.Text;
    
    // 实现接口方法...
}
```

### 3.2 形状注释插件

`ShapeAnnotationPlugin`允许用户在甘特图上添加各种形状作为标识。它支持以下形状：

- 矩形
- 圆形
- 三角形
- 星形
- 菱形

每个形状都可以自定义颜色、边框、大小和透明度。

### 3.3 线条注释插件

`LineAnnotationPlugin`允许用户在甘特图上绘制各种类型的线条。它支持以下线条类型：

- 实线
- 虚线
- 点线
- 点划线
- 双点划线

每个线条都可以自定义颜色、粗细和透明度。

## 4. 插件服务

`PluginService`是插件系统的核心服务，负责管理和加载所有可用的插件：

```csharp
public class PluginService : IPluginService
{
    public List<IAnnotationPlugin> GetAnnotationPlugins()
    {
        var plugins = new List<IAnnotationPlugin>();
        
        // 加载所有可用的插件
        plugins.Add(new TextAnnotationPlugin());
        plugins.Add(new ShapeAnnotationPlugin());
        plugins.Add(new LineAnnotationPlugin());
        
        return plugins;
    }
}
```

## 5. 插件视图模型

`PluginViewModel`是连接插件服务和用户界面的桥梁，负责：

- 从插件服务获取所有可用插件
- 管理用户选择的插件
- 提供创建标识的命令

```csharp
public class PluginViewModel : BindableBase
{
    // 属性和命令定义
    
    private void CreateAnnotation(IAnnotationPlugin plugin)
    {
        // 创建并配置标识元素
        // 将标识元素添加到甘特图
    }
}
```

## 6. 插件用户界面

PluginView.xaml提供了一个友好的用户界面，允许用户：

- 浏览和选择可用的插件
- 查看插件的描述信息
- 配置插件的属性
- 创建图形标识

## 7. 使用方法

1. 在插件列表中选择一个插件类型
2. 在右侧配置面板中设置插件的属性
3. 点击"创建标识"按钮
4. 在甘特图上选择位置放置标识

## 8. 扩展指南

### 8.1 创建新插件

要创建新的插件，需要：

1. 创建一个实现`IAnnotationPlugin`接口的类
2. 为插件创建一个继承自`IAnnotationConfig`的配置类
3. 在`PluginService`中注册新插件

### 8.2 示例：创建新的高亮插件

```csharp
public class HighlightConfig : IAnnotationConfig
{
    // 配置属性
}

public class HighlightPlugin : IAnnotationPlugin
{
    // 实现接口方法
}
```

## 9. 未来规划

1. 实现动态加载插件（从外部DLL加载）
2. 添加更多类型的图形标识插件
3. 增强插件配置选项
4. 实现插件持久化（保存和加载插件配置）
5. 添加插件排序和分类功能